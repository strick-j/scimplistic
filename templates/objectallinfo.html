{{template "_head.html" .}}

<!-- End Main Header -->

<!-- Place Add Button for Page - Triggers script.js -->
<div class="position-relative">  
  <button class="btn-primary btn floating-action-icon floating-action-icon-add">
    <span class="position-absolute fs-1 bi bi-plus top-50 start-50 translate-middle"></span>
  </button>
</div>

<!-- Modal triggered by Add Button / script.js-->
  <div class="modal" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="new{{.Navigation}}Label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          {{ if .CreateForm}} {{ $value := .CreateForm}} {{ $formrole := .CreateForm.FormRole}}
          <h5 class="modal-title" id="{{.Navigation}}ModalLabel">{{ $value.FormLegend}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="{{ $value.FormAction}}" method="{{$value.FormMethod}}" class="needs-validation" novalidate>
            {{ if eq .Navigation "Settings" }}
            {{if .SettingsConfigured}}
            <div class="alert alert-success" role="alert">
              Settings have already been configued. If you submit again, previous settings will be overwritten.
            </div>
            {{else}}
            <div class="alert alert-danger" role="alert">
              Settings have not been configured. Please configure using the form below.
            </div>
            {{end}}
            {{end}}
            {{range $value.FormFields}}
            <div class="mb-3">
              <label for="{{ .FieldLabel}}" class="form-label">{{ .FieldLabelText}}</label>
              <input type="{{ .FieldInputType}}" name="{{ .FieldInputName}}" class="form-control" id="{{ .FieldLabel}}" {{
                if .FieldDescBy}} aria-describedby="{{ .FieldDescBy}}" {{end}} {{ if .FieldPlaceHold}}
                placeholder="{{.FieldPlaceHold}}" {{end}} {{if .FieldRequired}}required{{end}}>
              {{ if .FieldDescBy}}<div id="{{.FieldDescBy}}" class="form-text">{{ .FieldHelp}}</div>{{end}}
              {{ if .FieldInFeedback}}<div class="invalid-feedback">{{ .FieldInFeedback}}</div>{{end}}
            </div>
            {{end}}
            {{ if eq $formrole "adduser"}}
            <div>
              <label for="userStatus" class="form-label">Activate User</label>
              <select class="mb-3 form-select" aria-label="ActiveSelection" id="userStatus">
                <option value="1">Yes</option>
                <option value="2">No</option>
              </select>
            </div> {{else if eq $formrole "configuresettings"}}
            <div class="mb-3">
              <label for="oathtoken" class="form-label">SCIM OATH Token</label>
              <textarea class="form-control" id="oathtoken" rows="8" name="FormOathToken" placeholder="{{ .Token}}"
                required></textarea>
              <div class="invalid-feedback">SCIM Endpoint OATH Token is Required</div>
            </div>
            {{end}}
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="accuracyCheck" required>
              <label class="form-check-label" for="accuracyCheck">Please review the above information for
                accuracy.</label>
            </div>
            {{ else}}
            <div>
              <h2>No form data available.</h2>
            </div>
            {{end}}
        </div>
        <div class="modal-footer">
          <button type="submit" value="submit" class="btn btn-primary">Submit</button> 
        </form>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row justify-content-md-center mt-3">
      <div class="col">
        <h2 id="templateLabel">{{ .Navigation}}</h2>
      </div>
    </div>
    <div class="row justify-content-md-center mb-3">
      <div class="col">
        <div class="card" id="total{{.Navigation}}">
          <div class="card-body">
            <h5 class="card-title">Total Count</h5>
            {{ if eq .Navigation "Safes"}}<p class="card-text">{{ .Safes.TotalResults}}</p>
            {{ else if eq .Navigation "Users"}}<p class="card-text">{{ .Users.TotalResults}}</p>
            {{ else if eq .Navigation "Groups"}}<p class="card-text">{{ .Groups.TotalResults}}</p>
            {{end}}
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-md-center mb-3">
      {{ if .Safes}} {{ $value := .Safes}}
      {{range $value.Resources}}
      <div class="accordion" id="safeAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading{{ .UniqueSafeId}}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse{{ .UniqueSafeId}}" aria-expanded="false"
              aria-controls="collapse{{ .UniqueSafeId}}">
              {{.DisplayName}}
            </button>
          </h2>
          <div id="collapse{{ .UniqueSafeId}}" class="accordion-collapse collapse"
            aria-labelledby="heading{{ .UniqueSafeId}}" data-bs-parent="#safeAccordian">
            <div class="accordion-body">
              <strong>Description: </strong>{{ .Description}} <br>
              <strong>Vault Safe ID: </strong>{{ .ID}} <br>
              <strong>Owner: </strong>{{.Owner.Display}} <br>
              <strong>Created: </strong>{{ .Meta.Created}} <br>
              <strong>Last Modified: </strong>{{ .Meta.LastModified}} <br>
              <strong>Retention Days: </strong>{{.UrnIetfParamsScimSchemasCyberark11Safe.NumberOfDaysRetention}} <br>
              <strong>Managing CPM: </strong> {{.UrnIetfParamsScimSchemasCyberark11Safe.ManagingCPM}}
              <div class="d-flex flex-row-reverse bd-highlight mb-3">
                <a href="#">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-danger bi bi-trash-fill">
                      <span class="visually-hidden">Delete</span>
                    </div>
                  </div>
                </a>
                <a href="#">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-secondary bi bi-pencil-fill">
                      <span class="visually-hidden">Edit</span>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{end}}
      {{end}}
      {{ if .Users}} {{ $value := .Users}}
      {{range $value.Resources}}
      <div class="accordion accordian-flush" id="userAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading{{ .ID}}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse{{ .ID}}" aria-expanded="false" aria-controls="collapse{{ .ID}}">
              {{ .DisplayName}}
            </button>
          </h2>
          <div id="collapse{{ .ID}}" class="accordion-collapse collapse" aria-labelledby="heading{{ .ID}}"
            data-bs-parent="#userAccordian">
            <div class="accordion-body">
              <strong>First Name: </strong>{{ .Name.GivenName}} <br>
              <strong>Last Name: </strong>{{ .Name.FamilyName}} <br>
              <strong>Vault User ID: </strong>{{ .ID}} <br>
              <strong>User Type: </strong>{{ .UserType}} <br>
              <strong>Active: </strong> {{ .Active}} <br>
              <strong>Entitlements: </strong>{{ .Entitlements}} <br>
              <strong>Created: </strong>{{ .Meta.Created}} <br>
              <strong>Last Modified: </strong>{{ .Meta.LastModified}} <br>
              <strong>Groups:</strong> <br>
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th scope="col">Group ID</th>
                    <th scope="col">DisplayName</th>
                    <th scope="col">Type</th>
                  </tr>
                </thead>
              {{range .Groups}}
              <tbody>
                <tr>
                  <th scope="row">{{.Value}}</th>
                  <td>{{.Display}}</td>
                  <td>{{.Type}}</td>
                </tr>
              {{end}}
              </tbody>
              </table>
              <div class="d-flex flex-row-reverse bd-highlight mb-3">
                <a href="#">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-danger bi bi-trash-fill">
                      <span class="visually-hidden">Delete</span>
                    </div>
                  </div>
                </a>
                <a href="#">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-secondary bi bi-pencil-fill">
                      <span class="visually-hidden">Edit</span>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{end}}
      {{end}}
      {{ if .Groups}} {{ $value := .Groups}}
      {{range $value.Resources}}
      <div class="accordion" id="groupAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading{{ .ID}}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse{{ .ID}}" aria-expanded="false" aria-controls="collapse{{ .ID}}">
              {{ .DisplayName}}
            </button>
          </h2>
          <div id="collapse{{ .ID}}" class="accordion-collapse collapse" aria-labelledby="heading{{ .ID}}"
            data-bs-parent="#groupAccordian">
            <div class="accordion-body">
              <strong>Vault Group ID: </strong>{{ .ID}} <br>
              <strong>Created: </strong>{{ .Meta.Created}} <br>
              <strong>Last Modified: </strong>{{ .Meta.LastModified}} <br>
              <strong>Members:</strong> <br>
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">DisplayName</th>
                    <th scope="col">Reference</th>
                  </tr>
                </thead>
              {{range .Members}}
              <tbody>
                <tr>
                  <th scope="row">{{.Value}}</th>
                  <td>{{.Display}}</td>
                  <td>{{.Ref}}</td>
                </tr>
              {{end}}
              </tbody>
              </table>
              <div class="d-flex flex-row-reverse bd-highlight mb-3">
                <a href="/groupdel/{{.ID}}">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-danger bi bi-trash-fill">
                      <span class="visually-hidden">Delete</span>
                    </div>
                  </div>
                </a>
                <a href="/groupupdate/{{.DisplayName}}">
                  <div class="ps-2 bd-highlight">
                    <div type="button" class="btn btn-outline-secondary bi bi-pencil-fill">
                      <span class="visually-hidden">Edit</span>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{end}}
      {{end}}
    </div>
  </div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous"></script>
	<script src="/static/js/script.js"></script>
	<script src="/static/js/formvalidate.js"></script>

	</body>

	</html>